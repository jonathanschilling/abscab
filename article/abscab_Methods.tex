\section{Methods}
\label{sec:methods}
In this section, accurate methods used to compute the magnetic vector potential and the magnetic field
of a straight wire segment and a circular wire loop are presented.
Furthermore, methods to evaluate the magnetostatic quantities in Cartesian coordinates are provided.
The section is concluded by a description of the verification procedure
employed to benchmark these methods.

\subsection{Straight Wire Segment}
The straight wire segment is handled first.
The basic geometry of a single wire segment is shown in Fig.~\ref{fig:straightWireSegment}.
\begin{figure}[htbp]
 \centering
 \includegraphics{img/straightWireSegment.eps}
 \caption{Geometry of a single wire segment. After Fig.~1 in Ref.~\cite{hanson_hirshman_2002}.}
 \label{fig:straightWireSegment}
\end{figure}

\subsubsection{Magnetic Vector Potential}
The magnetic vector potential of a straight wire segment
only has component~$A_z$ parallel to the wire that is given by:
\begin{equation}
  A_z(\rho, z) = \frac{\mu_0 I}{4 \pi} \ln \left( \frac{1+\epsilon}{1 - \epsilon} \right)
\end{equation}
with
\begin{align}
  \epsilon =&\, \frac{L}{R_i + R_f} \\
       R_i =&\, \sqrt{\rho^2 + z^2} \\
       R_f =&\, \sqrt{\rho^2 + (1-z)^2} \, .
\end{align}
Here, we use normalized coordinates~$\rho' = \rho/L$ and~$z' = z/L$.
This leads to the following expressions for~$r_i = R_i/L$ and~$r_f = R_f/L$:
\begin{align}
  r_i =&\, \sqrt{{\rho'}^2 +      {z'}^2 } \label{eqn:r_i_default} \\
  r_f =&\, \sqrt{{\rho'}^2 + (1 - {z'})^2} \label{eqn:r_f_default} \\
  \epsilon =&\, \frac{1}{r_i + r_f} \, .
\end{align}
A common prefactor depending on the current~$I$ and~$\mu_0$ is split off:
\begin{equation}
  A_z(\rho, z) = \frac{\mu_0 I}{2 \pi} \tilde{A}_z (\rho', z')
\end{equation}
with
\begin{equation}
  \tilde{A}_z (\rho', z')
  = \frac{1}{2} \ln \left( \frac{1+\epsilon}{1 - \epsilon} \right)
  = \textrm{atanh} (\epsilon) \, .
  \label{eqn:A_z_tilde}
\end{equation}
The rest of this section can thus focus on accurate computation of $\tilde{A}_z (\rho', z')$.

The region close to the wire segment~(``near-field'') is handled by one of the following three formulations.
The parameter~$\epsilon$ approaches a value of~$1$ as the location of the evaluation point comes closer to the wire segment.
Thus, the denominator in \eqn{A_z_tilde} vanishes, leading to a logarithmic singularity in~$\tilde{A}_z$
as the evaluation point~$(\rho', z')$ gets nearer to the wire segment.
It is therefore favorable to formulate the near-field method in terms of~$(1-\epsilon)$:
\begin{align}
  1-\epsilon =&\, 1 - \frac{1}{r_i + r_f} = \frac{r_i + r_f - 1}{r_i + r_f} = \frac{r_i + r_f - 1}{(r_i + r_f - 1) + 1} = \frac{n}{n + 1}
\end{align}
with~$n \equiv r_i + r_f - 1$ approaching~$0$ as the evaluation point approaches the wire segment.
Inserting this formulation for~$1-\epsilon$ into \eqn{A_z_tilde} leads to:
\begin{align}
  \tilde{A}_{z,\mathrm{nf}} (\rho', z')
  =&\, \frac{1}{2}  \left[ \ln\left(2 - (1-\epsilon)        \right) - \ln \left(1 - \epsilon    \right) \right] \nonumber \\
  =&\, \frac{1}{2}  \left[ \ln\left(2 - \frac{n}{n + 1}     \right) - \ln \left(\frac{n}{n + 1} \right) \right] \nonumber \\
  =&\, \frac{1}{2}  \left[ \ln\left(\frac{2(n+1) - n}{n + 1}\right) - \ln \left(\frac{n}{n + 1} \right) \right] \nonumber \\
  =&\, \frac{1}{2}  \left[ \ln\left(n + 2                   \right) \cancel{- \ln\left(n + 1 \right)} - \ln \left( n \right) \cancel{+ \ln \left( n + 1 \right)} \right] \nonumber \\
  =&\, \frac{1}{2}  \left[ \ln\left(n + 2                   \right) - \ln \left( n \right) \right] \, .
\end{align}
The subscript ``nf'' was introduced to indicate that this formulation shall only be used for the near-field.
The method used to compute~$n$ still has to be switched depending to the exact location of the evaluation point:
\begin{equation}
  n = \begin{cases}
        n_{6a} &:\, z' \geq 1 \textrm{ or } \rho'/(1-z') \geq 1 \\
        n_{6b} &:\, z' \geq 0 \textrm{ and } \rho'/z' \leq 1 \\
        n_{6c} &:\, \textrm{else}
      \end{cases} \, .
\end{equation}
% A_6a start
The first special case introduces a nutritious zero~($-z' + z'$) into~$n$:
\begin{equation}
  n_{6a} = (r_i - z') + r_f + (z'-1) \, .
\end{equation}
The first contribution to~$n$ is then computed as follows:
\begin{equation}
  r_i - z' = 2 z' \sin^2(\alpha/2) / \cos(\alpha) \label{eqn:ri_zp}
\end{equation}
with $\alpha = \texttt{atan2}(\rho', z')$.
Additionally, $r_f$ is computed via \eqn{r_f_default} and $(z'-1)$ is computed directly.
% A_6a end
% A_6b start
The second special case is based on the first one and introduces another angle~$\beta$
used to compute~$r_f + (z'-1)$ directly:
\begin{equation}
  (r_f + z' - 1) = 2 (1 - z') \sin^2(\beta/2) / \cos(\beta) \label{eqn:rf_zp_1}
\end{equation}
with~$\beta = \texttt{atan2}(\rho', 1-z')$.
Then, $n$ is computed as:
\begin{equation}
  n_{6b} = (r_i - z') + (r_f + z'-1)
\end{equation}
with $(r_i - z')$ from \eqn{ri_zp} and $(r_f + z' - 1)$ from \eqn{rf_zp_1}.
% A_6b end
% A_6c start
The third special case is formulated slightly differently.
Here, $(r_f-1)$ is formulated as:
\begin{equation}
  r_f - 1 = 2 r_f \sin^2(\beta/2) - z' \label{eqn:rf_1}
\end{equation}
with $\beta$ as in the second special case
and $r_i$ and $r_f$ from \eqn{r_i_default} and \eqn{r_f_default}, respectively.
This leads to:
\begin{equation}
  n_{6c} = r_i + (r_f - 1)
\end{equation}
with $(r_f - 1)$ from \eqn{rf_1}.
% A_6c end
This concludes the methods for the near-field evaluation.
Two further special cases are considered next: $\rho' = 0$ and the combined case ($z'=0$, $z'=1$).
For the case of $\rho'=0$, the following formulation should be used:
\begin{equation}
  \tilde{A}_z (\rho'=0, z')
  = \begin{cases}
      \tilde{A}_2(z')  &:\, z' < -1 \textrm{ or } z' > 2 \\
      \tilde{A}_{2b}(z') &:\, \textrm{else, except } z' \in [0, 1]
    \end{cases}
\end{equation}
with
\begin{equation}
  \tilde{A}_2(z') = \textrm{atanh}\left( \frac{1}{|z'| + |1 - z'|} \right)
\end{equation}
and
\begin{equation}
  \tilde{A}_{2b}(z') = \frac{1}{2} \frac{z'}{|z'|} \ln \left(\left| \frac{z'}{1-z'} \right| \right) \, .
\end{equation}
The following formulation should be used for the cases $z'=0$ or $z'=1$:
\begin{equation}
  \tilde{A}_z (\rho', z' \in \{0, 1\})
  = \begin{cases}
      \tilde{A}_3(\rho')  &:\, \rho' > 1 \\
      \tilde{A}_{3b}(\rho') &:\, \textrm{else}
    \end{cases}
\end{equation}
with
\begin{equation}
  \tilde{A}_3(z') = \textrm{atanh}\left( \frac{1}{\rho' + \sqrt{{\rho'}^2 + 1}} \right)
\end{equation}
and
\begin{align}
  \tilde{A}_{3b}(z') =&\, \frac{1}{2} \ln \left(\frac{\rho' c + 1 + c}{\rho' c + 2 s^2 }\right) \\
  c =&\, \cos(\alpha) = \left[{\rho'}^2 + 1 \right]^{-1/2} \\
  s =&\, \sin(\alpha/2)  \\
 \alpha =&\, \arctan(\rho') \, .
\end{align}
If none of above special cases applies,
the following general formulation is used for the ``far-field'' case:
\begin{equation}
  \tilde{A}_{z,\mathrm{ff}} (\rho', z') = \textrm{atanh}\left( \frac{1}{r_i + r_f} \right)
\end{equation}
with $r_i$ and $r_f$ from \eqn{r_i_default} and \eqn{r_f_default}, respectively.
%
% total assembly of A_z for straight wire segment
%
The overall switching between the methods introduced above is done as follows:
\begin{equation}
  \tilde{A}_z (\rho', z')
  = \begin{cases}
      \tilde{A}_z (\rho'=0, z')             &:\, \rho' = 0 \\
      \tilde{A}_z (\rho', z' \in \{0, 1\})  &:\, z' \in \{0, 1\} \\
      \tilde{A}_{z,\mathrm{nf}} (\rho', z') &:\, z' \in ]-1, 2] \textrm{ and } \rho' < 1 \\
      \tilde{A}_{z,\mathrm{ff}} (\rho', z') &:\, \textrm{else}
    \end{cases} \, .
\end{equation}

\subsubsection{Magnetic Field}
The magnetic field of a straight wire segment
only has a tangential component~$B_\varphi$ around the wire that is given by:
\begin{equation}
  B_\varphi(\rho, z) = \frac{\mu_0 I}{4 \pi} \frac{2 L (R_i + R_f)}{R_f} \frac{1}{\left(R_i + R_f\right)^2 - L^2}
\end{equation}
with~$L$, $R_i$ and $R_f$ as in the previous section.
Again a normalization factor is split off:
\begin{equation}
  B_\varphi(\rho, z) = \frac{\mu_0 I}{4 \pi L} \tilde{B}_\varphi(\rho', z')
\end{equation}
with
\begin{align}
  \tilde{B}_\varphi(\rho', z')
  =&\, \frac{2 L^2(R_i + R_f)}{R_f} \frac{1}{\left(R_i + R_f\right)^2 - L^2} \nonumber \\
  =&\, \left(\frac{r_i}{r_f} + 1\right) \frac{2}{\left(r_i + r_f\right)^2 - 1} \, .
\end{align}
The special case~$\rho'=0$ is handled first:
\begin{equation}
  \tilde{B}_\varphi(\rho'=0, z') = \frac{1}{2} \left( \frac{1}{(1-z')^2} - \frac{1}{z'(1-z')} \right) \, .
\end{equation}
Similarly, a special case for~$z' \in \{0, 1\}$ can be derived:
\begin{equation}
  \tilde{B}_\varphi(\rho', z' \in \{0, 1\}) = \frac{1}{\rho' \sqrt{{\rho'}^2 + (1-z')^2}} \, .
\end{equation}
The next method handles the evaluation locations far away from the loop
as well as a part of the near-field:
\begin{equation}
  \tilde{B}_{\varphi,4} (\rho', z')
  = \left(\frac{r_i}{r_f} + 1\right) \frac{1}{{\rho'}^2 + r_i r_f - z' (z' - 1)} \, .
\end{equation}
For certain evaluation points close to the loop,
the terms~$r_i r_f$ and $-z' (z' - 1)$ in above formula almost cancel each other.
This cancellation introduces a requirement for one more method to compute~$\tilde{B}_\varphi (\rho', z')$:
\begin{equation}
  \tilde{B}_{\varphi, 5} (\rho', z')
  = \frac{r_i / r_f + 1}
         {{\rho'}^2 + z' (1 - z') \frac{2}{\cos(\alpha)} \left( \frac{\sin^2(\beta/2)}{\cos(\beta)} + \sin^2(\alpha/2) \right)}
\end{equation}
with~$\alpha$ and~$\beta$ as introduced for \eqn{ri_zp} and \eqn{rf_zp_1}.
%
% total assembly of B_phi for straight wire segment
%
The overall switching between the methods introduced above is done as follows:
\begin{equation}
  \tilde{B}_\varphi (\rho', z')
  = \begin{cases}
      \tilde{B}_\varphi(\rho'=0, z')             &:\, \rho' = 0 \\
      \tilde{B}_\varphi(\rho', z' \in \{0, 1\})  &:\, z' \in \{0, 1\} \\
      \tilde{B}_{\varphi,4} (\rho', z') &:\, z' \notin ]0,1[ \textrm{ or } \rho' \geq 1 \\
                                   ~    & ~ \textrm{ or } \rho'/(1-z') \geq 1  \\
                                   ~    & ~ \textrm{ or } \rho'/z'   \geq 1 \\
      \tilde{B}_{\varphi,5} (\rho', z') &:\, \textrm{else}
    \end{cases} \, .
\end{equation}

\subsection{Circular Wire Loop}
The circular wire loop is handled next.
The basic geometry of a circular wire loop under consideration here is shown in Fig.~\ref{fig:circularWireLoop}.
\begin{figure}[htbp]
 \centering
 \includegraphics[width=0.5\textwidth]{img/circularWireLoop.eps}
 \caption{Geometry of a circular wire loop centered at the origin with normal vector aligned with the $z$-axis.
          The radius of the loop is denoted $a$ and a current $I$ flows in the indicated direction.
          The magnetic field and vector potential are to be evaluated at the point $\mathbf{x}$ in the ($x$, $z$)-plane.}
 \label{fig:circularWireLoop}
\end{figure}

Similar to the case of the straight wire segment,
the magnetic vector potential and the magnetic field of the circular wire loop
are assembled from various formulations for special cases of the far-field and the near-field.

\subsubsection{Magnetic Vector Potential}
The magnetic vector potential of a circular wire loop
only has a tangential component~$A_\varphi$
which is given by the following formula:
\begin{equation}
  A_\varphi(\rho, z)
  = \frac{\mu_0 I}{\pi} \frac{1}{\sqrt{z'^2 + (1 + \rho')^2}}
    \,\mathrm{cel}(k_c, 1, -1, 1) \, .
\end{equation}
Normalized coordinates are used ($\rho' = \rho/a$ and $z' = z/a$ where $a$ is the radius of the loop)
and $k_c$ is given by:
\begin{equation}
  k_c^2 = \frac{z'^2 + (1 - \rho')^2}{z'^2 + (1 + \rho')^2} \, .
\end{equation}
A physics-oriented prefactor is split off to be able to focus on geometry in the following:
\begin{equation}
  A_\varphi(\rho, z) = \frac{\mu_0 I}{\pi} \tilde{A}_\varphi(\rho',z') \, ,
\end{equation}
leading to:
\begin{equation}
  \tilde{A}_\varphi(\rho',z')
  = \frac{1}{\sqrt{z'^2 + (1 + \rho')^2}} \,\mathrm{cel}(k_c, 1, -1, 1) \, .
\end{equation}
At~$\rho'=0$ the magnetic vector potential of a circular wire loop vanishes exactly:~$\tilde{A}_\varphi(\rho'=0,z') = 0$.
The following method works for evaluation locations not too close to the wire loop:
\begin{equation}
  \tilde{A}_{\varphi,1} (\rho',z')
  = \frac{k^2}{\sqrt{{z'}^2 + 1 + {\rho'}^2 + 2 \rho'}} \,\mathcal{C}(k_c)
\end{equation}
with
\begin{equation}
  k^2 = 1 - k_c^2 = \frac{4 \rho'}{{z'}^2 + 1 + {\rho'}^2 + 2 \rho'}
\end{equation}
and
\begin{equation}
  \mathcal{C}(k_c)
  = \frac{2 \,\mathcal{D}(k_c) - \mathcal{K}(k_c)}{k^2}
  = \,\mathrm{cel} \left( \frac{2 \sqrt{k_c}}{1 + k_c}, 1, 0, \frac{2}{(1 + k_c)^3} \right) \, . \label{eqn:elliptic_c}
\end{equation}
In there:
\begin{equation}
  \mathcal{D}(k_c)
  = \frac{\mathcal{K}(k_c) - \,\mathcal{E}(k_c)}{k^2}
  = \,\mathrm{cel}(k_c, 1, 0, 1) \label{eqn:elliptic_d}
\end{equation}
and
\begin{align}
  \mathcal{K}(k_c) =&\, \mathrm{cel}(k_c, 1, 1, 1)          \label{eqn:elliptic_k} \\
  \mathcal{E}(k_c) =&\, \mathrm{cel}(k_c, 1, 1, k_c^2) \, . \label{eqn:elliptic_e}
\end{align}
Close to the wire loop, the following formulation is used:
\begin{equation}
  \tilde{A}_{\varphi,6} (\rho',z')
  = \frac{1}{|\rho' - 1| \sqrt{\left( \frac{z'}{\rho'-1} \right)^2 + \left(1 + \frac{2}{\rho'-1} \right)^2 }}
    \,\mathrm{cel}(\sqrt{k_c^2}, 1, -1, 1)
\end{equation}
with $k_c^2$ computed as follows:
\begin{equation}
  k_c^2 = \frac{\left( \frac{z'}{\rho'-1} \right)^2 + 1}{\left( \frac{z'}{\rho'-1} \right)^2 + \left(1 + \frac{2}{\rho'-1} \right)^2} \, .
\end{equation}
At~$\rho' = 1$, some further simplification can be carried out.
This leads to the following formulation for~$\rho' = 1$ and~$\sqrt{\epsilon} <= z' < 1$ (where $\epsilon$ is the machine precision):
\begin{equation}
  \tilde{A}_{\varphi,5} (\rho'=1, z') = \frac{1}{z'} \,\mathrm{cel}(k_c, 1, 1, -1)
\end{equation}
with $k_c$ computed as follows:
\begin{equation}
  k_c = \frac{1}{z'} \sqrt{4 + {z'}^2} \, .
\end{equation}
%
% total assembly of A_phi for circular wire loop
%
The overall switching between the methods introduced above is done as follows:
\begin{equation}
  \tilde{A}_\varphi (\rho', z')
  = \begin{cases}
      0                                 &:\, \rho' = 0            \\
      \tilde{A}_{\varphi,1} (\rho', z') &:\, z' \geq 1 \textrm{ or } \rho' \notin [1/2, 2] \\
      \tilde{A}_{\varphi,6} (\rho', z') &:\, \rho' \neq 1         \\
      \tilde{A}_{\varphi,5} (\rho', z') &:\, \textrm{else}
    \end{cases} \, .
\end{equation}

\subsubsection{Magnetic Field}
The magnetic field produced by a circular wire loop is made up of two components:
$B_\rho$ denotes the radial component and $B_z$ denotes the vertical component.
The radial component~$B_\rho$ is given by:
\begin{equation}
  B_\rho(\rho', z')
  = \frac{\mu_0 I}{\pi a} \frac{z'}{\left[ z'^2 + (1 + \rho')^2 \right]^{\frac{3}{2}}} \,\mathrm{cel}(k_c, k_c^2, -1, 1)
\end{equation}
Also here, a normalization factor is split off:
\begin{equation}
  B_\rho(\rho, z) = \frac{\mu_0 I}{\pi a} \tilde{B}_\rho(\rho', z')
\end{equation}
with
\begin{align}
  \tilde{B}_\rho(\rho', z')
  =&\, \frac{z'}{\left[ z'^2 + (1 + \rho')^2 \right]^{\frac{3}{2}}} \,\mathrm{cel}(k_c, k_c^2, -1, 1) \, .
\end{align}
At~$\rho'=0$ (any $z'$) and at $z'=0$ (any $\rho'$)
the radial component of the magnetic field of a circular wire loop vanishes exactly:~$\tilde{B}_\rho(\rho'=0 \textrm{ or } z'=0) = 0$.
The following method works for evaluation locations not too close to the wire loop:
\begin{equation}
  \tilde{B}_{\rho, 3} (\rho', z')
  = \frac{4 \rho' z' \left[ \,\mathcal{D}(k_c) - \,\mathcal{C}(k_c) \right]}
         {\left[{z'}^2 + (1 + \rho')^2 \right]^{3/2} \left[{z'}^2 + (1 - \rho')^2 \right] } \, .
\end{equation}
For points close to the wire loop but with~$\rho' \neq 1$,
the following formulation is used:
\begin{align}
  \tilde{B}_{\rho, 1}& (\rho', z')
  = \frac{4 \rho' \left[ \,\mathcal{D}(k_c) - \,\mathcal{C}(k_c) \right]}
         {(\rho' - 1)^4 \left| \frac{z'}{\rho' - 1} \right|} \nonumber \\
  ~& \left\{
      \left[ \left( \frac{z'}{\rho'-1} \right)^2 + \left(1 + \frac{2}{\rho'-1} \right)^2 \right]^{3/2}
      \left[ \left( \frac{z'}{\rho'-1} \right)^2 + 1 \right]
    \right\}^{-1}
\end{align}
For $\rho'=1$ the following formulation is used:
\begin{align}
  \tilde{B}_{\rho, 4} (\rho'=1, z')
  =&\, \frac{1}{2 \sqrt{1 + 4/{z'}^2}} \nonumber \\
  ~& \left[  \frac{\mathcal{E}(k_c)}{1 + 4/{z'}^2} \left( 1 + \frac{1}{{z'}^2} \left( 6 + \frac{8}{{z'}^2} \right) \right)
            - \mathcal{K}(k_c) \right]
\end{align}
with
\begin{equation}
  k_c^2 = \frac{1}{1 + 4/{z'}^2} \, .
\end{equation}
%
% total assembly of B_rho for circular wire loop
%
The overall switching between the methods introduced above is done as follows:
\begin{equation}
  \tilde{B}_\rho(\rho', z')
  = \begin{cases}
      0                                 &:\, \rho' = 0 \textrm{ or } z' = 0 \\
      \tilde{B}_{\rho,3} (\rho', z') &:\, z' \geq 1 \textrm{ or } \rho' \notin [1/2, 2] \\
      \tilde{B}_{\rho,1} (\rho', z') &:\, \rho' \neq 1         \\
      \tilde{B}_{\rho,4} (\rho', z') &:\, \textrm{else}
    \end{cases} \, .
\end{equation}

The vertical component~$B_z$ is given by:
\begin{align}
 B_z(\rho', z')
 =&\, \frac{\mu_0 I}{2 \pi a}
   \frac{1}{\rho' \sqrt{z'^2 + (1 + \rho')^2}} \nonumber \\
 ~& \left[
       \textrm{cel}(k_c, 1, -1, 1)
     + \frac{1 + k_c^2 - \left( 1 - k_c^2 \right) \rho'}{2} \textrm{cel}(k_c, k_c^2, -1, 1)
   \right]
\end{align}

{\color{red}
TODO: There is a factor of 2 too much in the denominator of $B_z$!
}

Finally, a normalization factor is split off here as well:
\begin{equation}
  B_z(\rho, z) = \frac{\mu_0 I}{2 \pi a} \tilde{B}_z(\rho', z')
\end{equation}
with
\begin{align}
  \tilde{B}_z(\rho', z')
  =&\, \frac{1}{\rho' \sqrt{z'^2 + (1 + \rho')^2}} \nonumber \\
 ~& \left[
       \textrm{cel}(k_c, 1, -1, 1)
     + \frac{1 + k_c^2 - \left( 1 - k_c^2 \right) \rho'}{2} \textrm{cel}(k_c, k_c^2, -1, 1)
   \right] \, .
\end{align}
The evaluation of this formula is split up as well into separate special cases.
For points not too close to the wire loop,
the following formulation is used:
\begin{align}
  \tilde{B}_{z,1} (\rho', z')
  =&\, \frac{1}{\sqrt{{z'}^2 + (1+\rho')^2} \left[{z'}^2 + (1 - \rho')^2 \right] } \nonumber \\
  ~&\,  \left[ \mathcal{E}(k_c) + \rho' \left( \mathcal{E}(k_c) - 2 \mathcal{K}(k_c) + 2 \mathcal{D}(k_c) \right) \right] \, .
\end{align}
A second method is needed for points with $\rho' > 2$:
\begin{equation}
  \tilde{B}_{z,2} (\rho', z')
  = \frac{1}{\sqrt{r_0} {\rho'}^3}
    \left[ \mathcal{E}(k_c) + \frac{4}{t} \left( \mathcal{C}(k_c) - \,\mathcal{D}(k_c) \right) \right]
\end{equation}
with
\begin{align}
  r_0
  = &\,             1 + \frac{1}{\rho'} \Biggl[
                  - 2 + \frac{1}{\rho'} \Biggl(
         3 {z'}^2 - 1 + \frac{1}{\rho'} \Biggl\{
       - 4 {z'}^2 + 4 \nonumber \\
  ~& + \frac{1}{\rho'} \Biggl[ 3 \left( {z'}^2 + 1 \right)^2 - 4 \left( {z'}^2 + 1 \right) \nonumber \\
  ~& + \frac{1}{\rho'} \Biggl(-2 \left( {z'}^2 + 1 \right)^2 + \frac{1}{\rho'} \left( {z'}^2 + 1 \right)^3
       \Biggr)
       \Biggr]
       \Biggr\}
       \Biggr)
       \Biggr]
\end{align}
and
\begin{equation}
  t = 1 + \frac{1}{\rho'} \left( 2 + \frac{1}{\rho'} \left[ {z'}^2 + 1 \right] \right) \, .
\end{equation}
The expression for $\tilde{B}_z$ becomes significantly simpler at $\rho'=1$,
which is considered next:
\begin{equation}
  \tilde{B}_{z,4} (\rho'=1, z')
  = \frac{1}{\left[ {z'}^2 + 4 \right]^{3/2}} \,\mathrm{cel}(\sqrt{k_c^2}, k_c^2, 2, 0)
\end{equation}
with
\begin{equation}
  k_c^2 = \frac{{z'}^2}{{z'}^2 + 4} \, .
\end{equation}
In the vicinity of the wire loop, but explicitly obeying $z' > 0$,
the following method should be used to compute $\tilde{B}_z$:
\begin{equation}
  \tilde{B}_{z,5} (\rho', z')
  = \frac{\left| \frac{z'}{\rho' - 1} \right| \,\mathrm{cel}\left( \sqrt{k_c^2}, k_c^2, \frac{1 + \rho'}{z'}, \frac{1 - \rho'}{z'} \right) }
         {\left(\rho' - 1 \right)^2 \left[ \left( \frac{z'}{\rho'-1} \right)^2 + \left(1 + \frac{2}{\rho'-1} \right)^2 \right]^{3/2} } \, .
\end{equation}
Finally, only one more expression is needed to accurately compute $\tilde{B}_z$ at $z'=0$ close to the loop.
Here it is:
\begin{equation}
  \tilde{B}_{z,6} (\rho', z'=0)
  = \frac{1}{|1 + \rho'|^3}
    \,\mathrm{cel}(k_c, k_c^2, 1+\rho', 1-\rho')
\end{equation}
with
\begin{equation}
  k_c = \frac{1-\rho'}{1+\rho'} \, .
\end{equation}
%
% total assembly of B_z for circular wire loop
%
The overall switching between the methods introduced above is done as follows:
\begin{equation}
  \tilde{B}_z(\rho', z')
  = \begin{cases}
      \tilde{B}_{z,1} (\rho', z') &:\, \rho' < 1/2 \textrm{ or } (\rho' < 2 \textrm{ and } z' \geq 1) \\
      \tilde{B}_{z,2} (\rho', z') &:\, \rho' \geq 2 \\
      \tilde{B}_{z,4} (\rho', z') &:\, \rho' = 1 \\
      \tilde{B}_{z,5} (\rho', z') &:\, z' \neq 0 \\
      \tilde{B}_{z,6} (\rho', z') &:\, \textrm{else}
    \end{cases} \, .
\end{equation}





\subsection{Transformation to Cartesian Coordinates}
Evaluation of the magnetic vector potential~$A$ and magnetic field~$B$
produced by the current carriers considered in this work
happens in cylindrical coordinates~$\rho$ and~$z$.
It is often more convenient to be able to work in Cartesian coordinates.
The methods given in this section show how to transform the evaluation location
into cylindrical coordinates in the frame of reference of the current carrier
and subsequently transform back the magnetostatic quantities into the global Cartesian coordinate system.

\subsubsection{Straight Wire Segment}



\subsubsection{Circular Wire Loop}
Figure~\ref{fig:mappingToCartesian} illustrates the setup of a circular wire loop.
\begin{figure}[htbp]
 \centering
 \includegraphics{img/MappingToCartesian.eps}
 \caption{Mapping the components to Cartesian coordinates for an exemplary circular wire loop.
          The loop is centered around its origin~$\mathbf{r}_0$.
          Its normal vector is denoted $\mathbf{n}$ and defines the orientation of the loop.
          The radius of the loop is denoted by~$a$.
          The evaluation location is denoted by~$\mathbf{r}$.}
 \label{fig:mappingToCartesian}
\end{figure}

The $z$-axis of the wire loop's coordinate system is defined by the normal vector~$\mathbf{n}$:
\begin{equation}
  \hat{\mathbf{e}}_z = \frac{\mathbf{n}}{|\mathbf{n}|} \, .
\end{equation}
The $z$ component of the evaluation location is thus obtained as follows:
\begin{equation}
  z = (\mathbf{r} - \mathbf{r}_0) \cdot \hat{\mathbf{e}}_z \, .
\end{equation}
The normalized $z$-coordinate $z'$ is then obtained as:
\begin{equation}
  z' = \frac{z}{a} = \frac{1}{a} (\mathbf{r} - \mathbf{r}_0) \cdot \hat{\mathbf{e}}_z \, .
\end{equation}
For the radial coordinate, first the vector~$\Delta \mathbf{r}$ is formed:
\begin{equation}
  \Delta \mathbf{r} = (\mathbf{r} - \mathbf{r}_0) - z \, \hat{\mathbf{e}}_z
\end{equation}
and the radial coordinate $\rho$ is then obtained by taking $\rho = |\Delta \mathbf{r}|$.
A unit vector in radial direction is formed as follows:
\begin{equation}
  \hat{\mathbf{e}}_\rho = \frac{\Delta \mathbf{r}}{\rho} \, .
\end{equation}
The normalized radial coordinate~$\rho'$ is then obtained as:
\begin{equation}
  \rho' = \frac{\rho}{a} = \frac{1}{a} |(\mathbf{r} - \mathbf{r}_0) - z \, \hat{\mathbf{e}}_z| \, .
\end{equation}
The magnetic field of the circular wire loop consists of two cylindrical components, namely $B_\rho$ and $B_z$.
The Cartesian magnetic field components are then computed as follows:
\begin{equation}
  \mathbf{B}(\mathbf{r}) = B_\rho \hat{\mathbf{e}}_\rho + B_z \hat{\mathbf{e}}_z \, .
\end{equation}
The magnetic vector potential only has a component in angular direction in the coordinate system of the wire loop.
The corresponding unit vector~$\hat{\mathbf{e}}_\varphi$ is then given by
$\hat{\mathbf{e}}_\varphi = \hat{\mathbf{e}}_\rho \times \hat{\mathbf{e}}_z$.
The vector potential of the circular wire loop in thus in Cartesian coordinates:
\begin{equation}
  \mathbf{A}(\mathbf{r}) = A_\varphi \hat{\mathbf{e}}_\varphi \, .
\end{equation}

\subsection{Superposition in multi-filament assemblies}
% PolygonFilament
An infinitely thin polygon filament $P$ is described by a list of $N$ points $\mathbf{x}_i$ with $i=1, ..., N$ in three-dimensional (3D) space and a current $I$.
The $(N-1)$ straight connecting lines between each two consecutive points $\mathbf{x}_i$ and $\mathbf{x}_{i+1}$ are assumed to represent the geometry of a wire which carries the current.
If the first and the last point of the polygon filament coincide, the wire forms a closed loop and $\nabla \cdot \mathbf{j} = 0$ is ensured by construction.

The magnetic vector potential $\mathbf{A}(I, \mathbf{x}_i, \mathbf{x}_{i+1}, \mathbf{x})$ and the magnetic field $\mathbf{B}(I, \mathbf{x}_i, \mathbf{x}_{i+1}, \mathbf{x})$
of the wire segments at a location $\mathbf{x}$ can be computed analytically.
The resulting contributions from each segment are superposed in order to compute the resulting magnetic field from the full length of the wire:
\begin{align}
 \mathbf{A}(\mathbf{x}) & = \sum_{i=1}^{N-1} \mathbf{A}(I, \mathbf{x}_i, \mathbf{x}_{i+1}, \mathbf{x}) \quad \mathrm{and} \\
 \mathbf{B}(\mathbf{x}) & = \sum_{i=1}^{N-1} \mathbf{B}(I, \mathbf{x}_i, \mathbf{x}_{i+1}, \mathbf{x}) \quad .
\end{align}
Computationally robust and efficient expressions for
$\mathbf{A}(I, \mathbf{x}_i, \mathbf{x}_{i+1}, \mathbf{x})$ and
$\mathbf{B}(I, \mathbf{x}_i, \mathbf{x}_{i+1}, \mathbf{x})$
are given in Ref.~\cite{hanson_hirshman_2002}.
The detailed derivation of these expressions is given below.

% multi-winding circular coil



\subsection{Verification Method}
The asymptotic behavior of an implementation of above formulas for the magnetic vector potential
and magnetic field needs to be tested before using that implementation in daily routine work.
A set of critical test points used to check this is shown in Fig.~\ref{fig:circularLoop_criticalPoints}
for the case of the circular wire loop.
\begin{figure}[htbp]
 \centering
 \includegraphics{img/circularLoop_criticalPoints.eps}
 \caption{Test points in the $R$-$Z$-plane for a circular wire loop (black dot).
          The axes are labeled in normalized cylindrical coordinates ($\rho' = \rho / a$, $z' = z / a$; $a$ is the radius of the wire loop).
          Green dashed lines indicate values of $\rho'$ and $z'$ which are well handled by a naive implementation.
          Green dots denote points at which a naive implementation yields satisfactory results.
          Red dashed lines indicate values of $\rho'$ and $z'$ which induce the requirement for robust asymptotic behavior.
          Red dots denote points at which a naive implementation usually fails.
          The grey shaded area in the background indicates the region in which the reference implementation yields accurate results.
          Note that the problem is symmetric in $z$ direction, even though only the positive-$z$ quadrant is considered here.}
 \label{fig:circularLoop_criticalPoints}
\end{figure}
